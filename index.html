<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mr Kjee Virtual Numbers</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small UI niceties */
    .hidden-panel { display:none; }
    .clickable { cursor:pointer; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">
  <!-- HEADER -->
  <header class="bg-white shadow">
    <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
      <div class="flex items-center gap-3">
        <img id="logoImg" src="https://i.imgur.com/4AiXzf8.png" alt="logo" class="w-12 h-12 rounded-full border" />
        <div>
          <div class="font-bold text-xl">Mr Kjee Virtual Numbers</div>
          <div class="text-xs text-gray-500">Instant OTP • Rentals • Developer API</div>
        </div>
      </div>

      <nav class="flex items-center gap-3">
        <div id="topBalance" class="hidden cursor-pointer px-3 py-2 rounded border text-sm"></div>
        <button id="navHome" class="px-3 py-2 rounded hover:bg-gray-100">Home</button>
        <button id="navBuy" class="px-3 py-2 rounded hover:bg-gray-100">Buy</button>
        <button id="navCheck" class="px-3 py-2 rounded hover:bg-gray-100">Check SMS</button>
        <button id="navSupport" class="px-3 py-2 rounded hover:bg-gray-100">Support</button>
        <div id="authButtons" class="flex gap-2">
          <button id="btnLogin" class="px-3 py-2 border rounded">Login</button>
          <button id="btnRegister" class="px-3 py-2 bg-indigo-600 text-white rounded">Register</button>
        </div>
        <div id="userMenu" class="hidden items-center gap-2">
          <span id="userEmail" class="text-sm"></span>
          <button id="btnLogout" class="px-2 py-1 text-sm border rounded">Logout</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-6xl mx-auto py-8 px-4">
    <!-- HOME -->
    <section id="pageHome" class="">
      <div class="bg-gradient-to-r from-indigo-600 to-violet-600 rounded-lg p-8 text-white flex gap-6 items-center">
        <div class="flex-1">
          <h1 class="text-3xl font-bold">Get OTP Numbers Instantly — Fast, Secure & Cheap</h1>
          <p class="mt-3 text-sm text-indigo-100">Activation (one-time OTP) and rental numbers (days/weeks/months). Aggregated providers shown as one marketplace.</p>
          <div class="mt-4 flex gap-3">
            <button id="ctaBuy" class="px-4 py-2 bg-white text-indigo-700 rounded-lg font-semibold">Buy Number</button>
            <button id="ctaHow" class="px-4 py-2 border border-white rounded-lg">How it works</button>
          </div>
        </div>
        <div class="w-1/3">
          <img src="https://images.unsplash.com/photo-1556157382-97eda2d62296?q=80&w=900&auto=format&fit=crop&ixlib=rb-4.0.3&s=1a5b5c8b3b7f7efe9d7b5f1e7d1f8c34" class="rounded-lg shadow" alt="hero"/>
        </div>
      </div>

      <div class="grid md:grid-cols-3 gap-4 mt-6">
        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold">Quick Buy</h3>
          <p class="text-sm text-gray-500 mt-2">No login required to browse. Login required to buy.</p>
          <div class="mt-3">
            <select id="quickType" class="w-full p-2 border rounded">
              <option value="activation">Activation (one-time OTP)</option>
              <option value="rental">Rental</option>
            </select>
            <select id="quickCountry" class="w-full p-2 border rounded mt-3"></select>
            <select id="quickService" class="w-full p-2 border rounded mt-3"></select>
            <div class="mt-3 flex gap-2">
              <button id="quickBuyBtn" class="px-3 py-2 bg-indigo-600 text-white rounded">Buy</button>
              <button id="quickViewBtn" class="px-3 py-2 border rounded">See Options</button>
            </div>
          </div>
        </div>

        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold">Why use Mr Kjee?</h3>
          <ul class="text-sm text-gray-600 mt-2 space-y-2">
            <li>• Merged providers for best prices</li>
            <li>• One-time OTP & long rentals</li>
            <li>• Developer API access</li>
            <li>• Crypto deposits (TRC20) supported</li>
          </ul>
        </div>

        <div class="bg-white p-4 rounded shadow">
          <h3 class="font-semibold">Support</h3>
          <p class="text-sm mt-2">Telegram: <a href="https://t.me/mrkjeeofficial" target="_blank" class="text-blue-600">@mrkjeeofficial</a></p>
          <p class="text-sm mt-1">Email: <a href="mailto:kamrankhandani4@gmail.com" class="text-blue-600">kamrankhandani4@gmail.com</a></p>
        </div>
      </div>
    </section>

    <!-- BUY PAGE -->
    <section id="pageBuy" class="hidden mt-6 bg-white p-6 rounded shadow">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Buy Number</h2>
        <div class="text-sm text-gray-500">Choose Country & Service</div>
      </div>

      <div class="grid md:grid-cols-3 gap-4 mt-4">
        <div>
          <label class="text-sm">Type</label>
          <select id="buyType" class="w-full p-2 border rounded mt-1">
            <option value="activation">Activation (OTP)</option>
            <option value="rental">Rental</option>
          </select>

          <label class="text-sm mt-3">Country</label>
          <select id="countrySelect" class="w-full p-2 border rounded mt-1"></select>

          <label class="text-sm mt-3">Service</label>
          <select id="serviceSelect" class="w-full p-2 border rounded mt-1"></select>

          <div class="mt-4">
            <label class="text-sm">Sort</label>
            <select id="sortSelect" class="w-full p-2 border rounded mt-1">
              <option value="alpha">Alphabetical</option>
              <option value="low">Lowest price</option>
              <option value="high">Highest price</option>
            </select>
          </div>

          <div class="mt-4">
            <div class="text-sm text-gray-500">Price (best available)</div>
            <div id="priceShow" class="text-2xl font-bold mt-1">$0.00</div>
            <button id="buyNowBtn" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded">Buy Now</button>
          </div>
        </div>

        <div class="md:col-span-2">
          <h3 class="font-semibold">Available offers (merged)</h3>
          <div id="offersList" class="mt-3 grid md:grid-cols-2 gap-3 max-h-[480px] overflow-auto"></div>
        </div>
      </div>
    </section>

    <!-- CHECK SMS PAGE -->
    <section id="pageCheck" class="hidden mt-6 bg-white p-6 rounded shadow">
      <h2 class="text-xl font-semibold">Check SMS (Order)</h2>
      <div class="mt-3 grid md:grid-cols-2 gap-4">
        <input id="checkOrderId" class="p-2 border rounded" placeholder="Enter Order ID" />
        <button id="checkOrderBtn" class="px-3 py-2 bg-indigo-600 text-white rounded">Check</button>
      </div>
      <div id="checkResult" class="mt-4"></div>
    </section>

    <!-- WALLET / PROFILE / HISTORY -->
    <section id="pageWallet" class="hidden mt-6 bg-white p-6 rounded shadow">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Wallet & Account</h2>
        <div class="text-sm text-gray-500">Balance and history</div>
      </div>

      <div class="mt-4 grid md:grid-cols-3 gap-4">
        <div class="p-4 border rounded">
          <div class="text-sm text-gray-500">Current balance</div>
          <div id="walletBalance" class="text-2xl font-bold mt-2">$0.00</div>
          <button id="depositBtn" class="mt-3 px-3 py-2 bg-green-600 text-white rounded">Deposit</button>
        </div>

        <div class="p-4 border rounded md:col-span-2">
          <h3 class="font-semibold">Your Numbers & History</h3>
          <div id="walletOrders" class="mt-3 space-y-2 max-h-64 overflow-auto"></div>
        </div>
      </div>
    </section>

    <!-- LOGIN / REGISTER MODALS (simple inline panels) -->
    <section id="pageAuth" class="hidden mt-6 bg-white p-6 rounded shadow">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-semibold">Login</h3>
          <input id="loginEmail" placeholder="Email" class="w-full p-2 border rounded mt-2" />
          <input id="loginPassword" placeholder="Password" type="password" class="w-full p-2 border rounded mt-2" />
          <button id="doLogin" class="mt-3 px-3 py-2 bg-indigo-600 text-white rounded">Login</button>
        </div>
        <div>
          <h3 class="font-semibold">Register</h3>
          <input id="regEmail" placeholder="Email" class="w-full p-2 border rounded mt-2" />
          <input id="regPassword" placeholder="Password" type="password" class="w-full p-2 border rounded mt-2" />
          <input id="regPassword2" placeholder="Confirm Password" type="password" class="w-full p-2 border rounded mt-2" />
          <button id="doRegister" class="mt-3 px-3 py-2 bg-indigo-600 text-white rounded">Register</button>
        </div>
      </div>
    </section>

    <!-- SUPPORT -->
    <section id="pageSupport" class="hidden mt-6 bg-white p-6 rounded shadow">
      <h2 class="text-xl font-semibold">Support</h2>
      <p class="mt-2">Telegram: <a href="https://t.me/mrkjeeofficial" target="_blank" class="text-blue-600">@mrkjeeofficial</a></p>
      <p class="mt-1">Email: <a href="mailto:kamrankhandani4@gmail.com" class="text-blue-600">kamrankhandani4@gmail.com</a></p>
    </section>

    <!-- ADMIN (placeholder) -->
    <section id="pageAdmin" class="hidden mt-6 bg-white p-6 rounded shadow">
      <h2 class="text-xl font-semibold">Admin (placeholder)</h2>
      <p class="mt-3 text-sm text-gray-500">Add provider keys and manage orders from the server side.</p>
    </section>

  </main>

  <!-- FOOTER -->
  <footer class="text-center py-6 text-sm text-gray-500">
    © 2025 Mr Kjee Virtual Numbers
  </footer>

<script>
/* ---------------------------
  Frontend app logic
  - Pure frontend: calls backend endpoints (you must implement)
  - Replace API_BASE with your deployed backend (Vercel serverless or node server)
--------------------------- */
const API_BASE = ""; // <-- IMPORTANT: set to your backend base URL (e.g., https://yoursite.vercel.app)
// Example: API_BASE = "https://mrkjee-backend.vercel.app"

// ---------- helpers ----------
const el = id => document.getElementById(id);
const money = v => '$' + Number(v || 0).toFixed(2);
const storage = { tokenKey: 'mrk_token' };

function setToken(t) { if (t) localStorage.setItem(storage.tokenKey, t); else localStorage.removeItem(storage.tokenKey); }
function getToken() { return localStorage.getItem(storage.tokenKey); }
function authHeaders() { const t = getToken(); return t ? { 'Authorization': 'Bearer ' + t } : {}; }

// ---------- SPA routing (show/hide sections) ----------
const pages = ['pageHome','pageBuy','pageCheck','pageWallet','pageAuth','pageSupport','pageAdmin'];
function showPage(id) {
  pages.forEach(p => el(p).classList.add('hidden'));
  el(id).classList.remove('hidden');
  window.scrollTo({top:0, behavior:'smooth'});
}
document.getElementById('navHome').onclick = ()=> showPage('pageHome');
document.getElementById('navBuy').onclick = ()=> showPage('pageBuy');
document.getElementById('navCheck').onclick = ()=> showPage('pageCheck');
document.getElementById('navSupport').onclick = ()=> showPage('pageSupport');
document.getElementById('ctaBuy').onclick = ()=> showPage('pageBuy');
document.getElementById('ctaHow').onclick = ()=> alert('How it works: Choose country & service → buy → check SMS in your orders.');

// ---------- Auth UI ----------
function updateAuthUI() {
  const token = getToken();
  if (token) {
    el('authButtons').classList.add('hidden');
    el('userMenu').classList.remove('hidden');
    // fetch user info
    fetchUserInfo().then(user => {
      if (!user) return;
      el('userEmail').textContent = user.email;
      el('topBalance').classList.remove('hidden');
      el('topBalance').textContent = money(user.balance);
      el('walletBalance').textContent = money(user.balance);
    });
  } else {
    el('authButtons').classList.remove('hidden');
    el('userMenu').classList.add('hidden');
    el('topBalance').classList.add('hidden');
  }
}
el('btnLogin').onclick = ()=> showPage('pageAuth');
el('btnRegister').onclick = ()=> showPage('pageAuth');
el('btnLogout').onclick = ()=> { setToken(null); updateAuthUI(); showPage('pageHome'); };

// ---------- Backend calls (expect these endpoints) ----------
/*
  Backend endpoints expected by this frontend:
  POST  {API_BASE}/api/auth/register   {email, password}          -> { token }
  POST  {API_BASE}/api/auth/login      {email, password}          -> { token }
  GET   {API_BASE}/api/user/me                                  -> { email, balance, orders:[] }
  GET   {API_BASE}/api/provider/countries                       -> [{ country, code, minPrice }]
  GET   {API_BASE}/api/provider/services?country=XX             -> [{ serviceName, minPrice, count }]
  GET   {API_BASE}/api/provider/offers?country=XX&service=Y     -> [{ provider, price, id }]
  POST  {API_BASE}/api/buy    { offerId }                       -> { orderId, number, expiresAt }
  GET   {API_BASE}/api/order/:orderId                            -> { sms: "...", status: "active" }
  POST  {API_BASE}/api/deposit/create { amount }                -> { paymentUrl } (redirect user)
  POST  {API_BASE}/api/webhook/deposit (server webhook)         -> credits user (server)
*/

/* Auth: register/login */
el('doRegister').onclick = async () => {
  const email = el('regEmail').value.trim();
  const p1 = el('regPassword').value;
  const p2 = el('regPassword2').value;
  if (!email || !p1) return alert('Enter email & password');
  if (p1 !== p2) return alert('Passwords do not match');
  try {
    const res = await fetch((API_BASE||'') + '/api/auth/register', {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email, password:p1})
    });
    if (!res.ok) throw await res.json();
    const data = await res.json();
    setToken(data.token);
    alert('Registered');
    updateAuthUI();
    showPage('pageWallet');
  } catch (e) { alert('Register error: ' + (e.error || JSON.stringify(e))); }
}

el('doLogin').onclick = async () => {
  const email = el('loginEmail').value.trim();
  const p = el('loginPassword').value;
  if (!email || !p) return alert('Enter email & password');
  try {
    const res = await fetch((API_BASE||'') + '/api/auth/login', {
      method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({email, password:p})
    });
    if (!res.ok) throw await res.json();
    const data = await res.json();
    setToken(data.token);
    updateAuthUI();
    alert('Login successful');
    showPage('pageWallet');
  } catch (e) { alert('Login error: ' + (e.error || JSON.stringify(e))); }
}

/* Fetch user info */
async function fetchUserInfo() {
  const token = getToken();
  if (!token) return null;
  try {
    const res = await fetch((API_BASE||'') + '/api/user/me', { headers: { ...authHeaders() }});
    if (!res.ok) { setToken(null); updateAuthUI(); return null; }
    return await res.json();
  } catch(e) { console.error(e); return null; }
}

/* Provider: get countries (merged list) */
async function loadCountries() {
  try {
    const res = await fetch((API_BASE||'') + '/api/provider/countries');
    if (!res.ok) throw await res.json();
    const list = await res.json(); // expected: [{country, code, minPrice}]
    // populate selects
    const cs = el('countrySelect'); const qc = el('quickCountry');
    cs.innerHTML = '<option value="">Choose country</option>';
    qc.innerHTML = '<option value="">Choose country</option>';
    list.forEach(c => {
      const opt = document.createElement('option'); opt.value = c.code || c.country; opt.textContent = `${c.country} — from ${money(c.minPrice)}`; cs.appendChild(opt);
      const opt2 = document.createElement('option'); opt2.value = c.code || c.country; opt2.textContent = `${c.country} — from ${money(c.minPrice)}`; qc.appendChild(opt2);
    });
  } catch(e){ console.error('countries', e); }
}

/* Provider: get services for country */
async function loadServices(countryCode) {
  try {
    const res = await fetch((API_BASE||'') + '/api/provider/services?country=' + encodeURIComponent(countryCode));
    if (!res.ok) throw await res.json();
    const list = await res.json(); // expected [{ serviceName, minPrice }]
    const ss = el('serviceSelect'); const qs = el('quickService');
    ss.innerHTML = '<option value="">Choose service</option>'; qs.innerHTML = '<option value="">Choose service</option>';
    list.forEach(s => {
      const opt = document.createElement('option'); opt.value = s.serviceName; opt.textContent = `${s.serviceName} — ${money(s.minPrice)}`; ss.appendChild(opt);
      const opt2 = document.createElement('option'); opt2.value = s.serviceName; opt2.textContent = `${s.serviceName}`; qs.appendChild(opt2);
    });
  } catch(e){ console.error('services', e); }
}

/* Offers for selection (merged offers across providers for selected country+service) */
async function loadOffers(countryCode, serviceName, sort='alpha') {
  try {
    const q = `/api/provider/offers?country=${encodeURIComponent(countryCode)}&service=${encodeURIComponent(serviceName)}&sort=${sort}`;
    const res = await fetch((API_BASE||'') + q);
    if (!res.ok) throw await res.json();
    const offers = await res.json(); // expected: [{id, provider, price, note}]
    const list = el('offersList'); list.innerHTML = '';
    let best = Infinity;
    offers.forEach(o=>{
      best = Math.min(best, o.price);
      const d = document.createElement('div');
      d.className = 'p-3 border rounded';
      d.innerHTML = `<div class="flex justify-between items-center"><div><div class="font-medium">${o.provider}</div><div class="text-xs text-gray-500">${o.note || ''}</div></div><div class="text-right"><div class="font-semibold">${money(o.price)}</div><div class="mt-2"><button data-id="${o.id}" class="buyOfferBtn px-3 py-1 bg-indigo-600 text-white rounded">Buy</button></div></div></div>`;
      list.appendChild(d);
    });
    el('priceShow').textContent = best === Infinity ? '$0.00' : money(best + 0.10); // show price with +$0.10 commission
    // attach buy buttons
    document.querySelectorAll('.buyOfferBtn').forEach(b=>{
      b.onclick = ()=> buyOffer(b.dataset.id);
    });
  } catch(e){ console.error('offers', e); }
}

/* Quick selectors handling */
el('countrySelect').onchange = ()=> {
  const c = el('countrySelect').value;
  if (!c) return;
  loadServices(c);
  el('serviceSelect').innerHTML = '<option value="">Loading...</option>';
};
el('quickCountry').onchange = ()=> {
  const c = el('quickCountry').value;
  if (!c) return;
  loadServices(c);
}

/* When service selected, load offers */
el('serviceSelect').onchange = ()=> {
  const c = el('countrySelect').value;
  const s = el('serviceSelect').value;
  if (!c || !s) return;
  loadOffers(c, s, el('sortSelect').value);
}

/* Sort change */
el('sortSelect').onchange = ()=> {
  const c = el('countrySelect').value; const s = el('serviceSelect').value;
  if (c && s) loadOffers(c,s, el('sortSelect').value);
}

/* Quick buy */
el('quickBuyBtn').onclick = async ()=>{
  const c = el('quickCountry').value; const s = el('quickService').value; const type = el('quickType').value;
  if(!c||!s) return alert('Choose country & service');
  // load offers and pick cheapest, then call buyOffer with chosen id
  try {
    const res = await fetch((API_BASE||'') + `/api/provider/offers?country=${encodeURIComponent(c)}&service=${encodeURIComponent(s)}&sort=low`);
    const offers = await res.json();
    if (!offers || !offers.length) return alert('No offers');
    const cheapest = offers[0];
    await buyOffer(cheapest.id);
  } catch(e){ alert('Quick buy error'); console.error(e); }
}

/* Buy an offer (calls backend /api/buy) */
async function buyOffer(offerId) {
  if (!getToken()) return alert('Please login first');
  try {
    const res = await fetch((API_BASE||'') + '/api/buy', {
      method:'POST',
      headers: { 'Content-Type':'application/json', ...authHeaders() },
      body: JSON.stringify({ offerId })
    });
    if (!res.ok) throw await res.json();
    const data = await res.json(); // expected { orderId, number, expiresAt }
    alert('Purchased. Order ID: ' + data.orderId);
    showPage('pageWallet');
    loadUserOrders();
  } catch(e){ alert('Buy error: ' + (e.error || JSON.stringify(e))); console.error(e); }
}

/* Load orders for wallet */
async function loadUserOrders() {
  const token = getToken(); if (!token) return;
  try {
    const res = await fetch((API_BASE||'') + '/api/user/me', { headers: {...authHeaders()} });
    const user = await res.json();
    el('walletBalance').textContent = money(user.balance);
    el('topBalance').textContent = money(user.balance);
    const container = el('walletOrders'); container.innerHTML = '';
    (user.orders || []).forEach(o => {
      const card = document.createElement('div'); card.className = 'p-3 border rounded flex justify-between items-center';
      const expired = o.expiresAt && (new Date(o.expiresAt) < new Date());
      card.innerHTML = `<div><div class="font-medium">${o.serviceName || o.serviceId}</div><div class="text-xs text-gray-500">${new Date(o.createdAt).toLocaleString()}</div><div class="text-xs ${expired ? 'text-red-500' : 'text-green-600'} mt-1">${expired ? 'Expired' : 'Active'}</div></div><div class="text-right"><div class="font-semibold">${money(o.price)}</div><div class="mt-2 text-xs">${o.number || '—'}</div></div>`;
      container.appendChild(card);
    });
  } catch(e){ console.error('load orders', e); }
}

/* Check order SMS */
el('checkOrderBtn').onclick = async ()=> {
  const id = el('checkOrderId').value.trim(); if (!id) return alert('Enter Order ID');
  try {
    const res = await fetch((API_BASE||'') + '/api/order/' + encodeURIComponent(id), { headers: {...authHeaders()} });
    if (!res.ok) throw await res.json();
    const o = await res.json();
    el('checkResult').innerHTML = `<pre class="p-3 bg-gray-100 rounded">${o.sms || 'No SMS yet'}</pre>`;
  } catch(e){ alert('Check error: ' + (e.error || JSON.stringify(e))); }
}

/* Deposit flow - redirect to payment link provided by backend */
el('depositBtn').onclick = async ()=> {
  if (!getToken()) return alert('Please login to deposit');
  const amount = prompt('Enter amount to deposit (min $2)');
  const value = parseFloat(amount);
  if (!value || value < 2) return alert('Minimum $2');
  try{
    const res = await fetch((API_BASE||'') + '/api/deposit/create', {
      method:'POST', headers:{ 'Content-Type':'application/json', ...authHeaders() }, body: JSON.stringify({ amount: value })
    });
    const j = await res.json();
    if (!res.ok) throw j;
    // backend returns paymentUrl
    window.location.href = j.paymentUrl;
  } catch(e) { alert('Deposit error: ' + (e.error || JSON.stringify(e))); }
}

/* Load initial data */
async function init() {
  updateAuthUI();
  // Load countries for selects (calls backend which aggregates providers)
  await loadCountries();
  // load services for quick selectors initially (first country)
  const copt = el('quickCountry').value;
  if (copt) await loadServices(copt);
  // load user orders if logged in
  if (getToken()) await loadUserOrders();
}
init();

</script>
</body>
</html>
